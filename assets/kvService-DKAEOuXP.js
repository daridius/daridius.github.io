import{g as j}from"./_commonjsHelpers-C-mxsbxT.js";import{encodeBase62 as k,decodeBase62 as K}from"./base62-2XzUJ1fN.js";var U={exports:{}},M;function O(){return M||(M=1,(function(d){var c=(function(){var f=String.fromCharCode,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",x={};function _(n,r){if(!x[n]){x[n]={};for(var a=0;a<n.length;a++)x[n][n.charAt(a)]=a}return x[n][r]}var v={compressToBase64:function(n){if(n==null)return"";var r=v._compress(n,6,function(a){return A.charAt(a)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(n){return n==null?"":n==""?null:v._decompress(n.length,32,function(r){return _(A,n.charAt(r))})},compressToUTF16:function(n){return n==null?"":v._compress(n,15,function(r){return f(r+32)})+" "},decompressFromUTF16:function(n){return n==null?"":n==""?null:v._decompress(n.length,16384,function(r){return n.charCodeAt(r)-32})},compressToUint8Array:function(n){for(var r=v.compress(n),a=new Uint8Array(r.length*2),t=0,i=r.length;t<i;t++){var h=r.charCodeAt(t);a[t*2]=h>>>8,a[t*2+1]=h%256}return a},decompressFromUint8Array:function(n){if(n==null)return v.decompress(n);for(var r=new Array(n.length/2),a=0,t=r.length;a<t;a++)r[a]=n[a*2]*256+n[a*2+1];var i=[];return r.forEach(function(h){i.push(f(h))}),v.decompress(i.join(""))},compressToEncodedURIComponent:function(n){return n==null?"":v._compress(n,6,function(r){return S.charAt(r)})},decompressFromEncodedURIComponent:function(n){return n==null?"":n==""?null:(n=n.replace(/ /g,"+"),v._decompress(n.length,32,function(r){return _(S,n.charAt(r))}))},compress:function(n){return v._compress(n,16,function(r){return f(r)})},_compress:function(n,r,a){if(n==null)return"";var t,i,h={},g={},m="",E="",p="",w=2,y=3,l=2,u=[],e=0,s=0,o;for(o=0;o<n.length;o+=1)if(m=n.charAt(o),Object.prototype.hasOwnProperty.call(h,m)||(h[m]=y++,g[m]=!0),E=p+m,Object.prototype.hasOwnProperty.call(h,E))p=E;else{if(Object.prototype.hasOwnProperty.call(g,p)){if(p.charCodeAt(0)<256){for(t=0;t<l;t++)e=e<<1,s==r-1?(s=0,u.push(a(e)),e=0):s++;for(i=p.charCodeAt(0),t=0;t<8;t++)e=e<<1|i&1,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=i>>1}else{for(i=1,t=0;t<l;t++)e=e<<1|i,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=0;for(i=p.charCodeAt(0),t=0;t<16;t++)e=e<<1|i&1,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=i>>1}w--,w==0&&(w=Math.pow(2,l),l++),delete g[p]}else for(i=h[p],t=0;t<l;t++)e=e<<1|i&1,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=i>>1;w--,w==0&&(w=Math.pow(2,l),l++),h[E]=y++,p=String(m)}if(p!==""){if(Object.prototype.hasOwnProperty.call(g,p)){if(p.charCodeAt(0)<256){for(t=0;t<l;t++)e=e<<1,s==r-1?(s=0,u.push(a(e)),e=0):s++;for(i=p.charCodeAt(0),t=0;t<8;t++)e=e<<1|i&1,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=i>>1}else{for(i=1,t=0;t<l;t++)e=e<<1|i,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=0;for(i=p.charCodeAt(0),t=0;t<16;t++)e=e<<1|i&1,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=i>>1}w--,w==0&&(w=Math.pow(2,l),l++),delete g[p]}else for(i=h[p],t=0;t<l;t++)e=e<<1|i&1,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=i>>1;w--,w==0&&(w=Math.pow(2,l),l++)}for(i=2,t=0;t<l;t++)e=e<<1|i&1,s==r-1?(s=0,u.push(a(e)),e=0):s++,i=i>>1;for(;;)if(e=e<<1,s==r-1){u.push(a(e));break}else s++;return u.join("")},decompress:function(n){return n==null?"":n==""?null:v._decompress(n.length,32768,function(r){return n.charCodeAt(r)})},_decompress:function(n,r,a){var t=[],i=4,h=4,g=3,m="",E=[],p,w,y,l,u,e,s,o={val:a(0),position:r,index:1};for(p=0;p<3;p+=1)t[p]=p;for(y=0,u=Math.pow(2,2),e=1;e!=u;)l=o.val&o.position,o.position>>=1,o.position==0&&(o.position=r,o.val=a(o.index++)),y|=(l>0?1:0)*e,e<<=1;switch(y){case 0:for(y=0,u=Math.pow(2,8),e=1;e!=u;)l=o.val&o.position,o.position>>=1,o.position==0&&(o.position=r,o.val=a(o.index++)),y|=(l>0?1:0)*e,e<<=1;s=f(y);break;case 1:for(y=0,u=Math.pow(2,16),e=1;e!=u;)l=o.val&o.position,o.position>>=1,o.position==0&&(o.position=r,o.val=a(o.index++)),y|=(l>0?1:0)*e,e<<=1;s=f(y);break;case 2:return""}for(t[3]=s,w=s,E.push(s);;){if(o.index>n)return"";for(y=0,u=Math.pow(2,g),e=1;e!=u;)l=o.val&o.position,o.position>>=1,o.position==0&&(o.position=r,o.val=a(o.index++)),y|=(l>0?1:0)*e,e<<=1;switch(s=y){case 0:for(y=0,u=Math.pow(2,8),e=1;e!=u;)l=o.val&o.position,o.position>>=1,o.position==0&&(o.position=r,o.val=a(o.index++)),y|=(l>0?1:0)*e,e<<=1;t[h++]=f(y),s=h-1,i--;break;case 1:for(y=0,u=Math.pow(2,16),e=1;e!=u;)l=o.val&o.position,o.position>>=1,o.position==0&&(o.position=r,o.val=a(o.index++)),y|=(l>0?1:0)*e,e<<=1;t[h++]=f(y),s=h-1,i--;break;case 2:return E.join("")}if(i==0&&(i=Math.pow(2,g),g++),t[s])m=t[s];else if(s===h)m=w+w.charAt(0);else return null;E.push(m),t[h++]=w+m.charAt(0),i--,w=m,i==0&&(i=Math.pow(2,g),g++)}}};return v})();d!=null?d.exports=c:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return c})})(U)),U.exports}var L=O();const b=j(L);function z(d){try{const c=JSON.stringify(d);return b.compressToUint8Array(c)}catch(c){throw console.error("Compression failed",c),new Error("No se pudo comprimir la data del Wrapped")}}function D(d){if(!d||d.length===0)return null;try{const c=b.decompressFromUint8Array(d);if(!c)return null;const f=JSON.parse(c);return console.log("✅ Data generically decompressed:",f),f}catch(c){return console.error("Generic decompression failed",c),null}}async function G(){const d=await crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]),c=await crypto.subtle.exportKey("raw",d),f=k(new Uint8Array(c));return{key:d,base64:f}}async function Z(d){const c=K(d);return crypto.subtle.importKey("raw",c.buffer,{name:"AES-GCM"},!1,["encrypt","decrypt"])}async function $(d,c){const f=crypto.getRandomValues(new Uint8Array(12)),A=await crypto.subtle.encrypt({name:"AES-GCM",iv:f},c,d.buffer),S=new Uint8Array(f.length+A.byteLength);S.set(f),S.set(new Uint8Array(A),f.length);let x="";for(let _=0;_<S.byteLength;_++)x+=String.fromCharCode(S[_]);return btoa(x)}async function J(d,c){const f=atob(d),A=new Uint8Array(f.length);for(let v=0;v<f.length;v++)A[v]=f.charCodeAt(v);const S=A.slice(0,12),x=A.slice(12),_=await crypto.subtle.decrypt({name:"AES-GCM",iv:S},c,x);return new Uint8Array(_)}const T="https://wasap.daridius.workers.dev";async function q(d){const c=await fetch(`${T}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:d})});if(!c.ok){const A=await c.text();throw console.error("KV Save Error Response:",A),new Error(`Failed to save to KV: ${c.status} ${c.statusText}`)}const f=await c.json();return console.log("KV Save Success:",f),f.key}async function C(d){const c=await fetch(`${T}/items/${d}`);if(c.status===404)throw new Error("Link no válido o caducado.");if(!c.ok)throw new Error(`Failed to fetch from KV: ${c.statusText}`);const f=await c.json();if(!f.value)throw new Error("El servidor no devolvió datos para esta clave.");return f.value}export{D as a,G as b,z as c,J as d,$ as e,C as g,Z as i,q as s};
