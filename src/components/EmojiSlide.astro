---
import Slide from "./Slide.astro";
import { wrappedData } from "../data";
---

<Slide class="emoji-slide">
    <div class="intro">
        <h2>Y emojis que no dejaron de aparecer...</h2>
    </div>

    <div class="emoji-podium" data-list="top_emojis">
        {
            /* Order: 2nd, 1st, 3rd. */
            [
                wrappedData.top_emojis[1],
                wrappedData.top_emojis[0],
                wrappedData.top_emojis[2],
            ]
                .filter(Boolean)
                .map((item) => {
                    const rank = wrappedData.top_emojis.indexOf(item) + 1;
                    return (
                        <div class={`emoji-item rank-${rank}`}>
                            <div class="emoji-char">{item.emoji}</div>
                            <div class="emoji-count">{item.count}</div>
                        </div>
                    );
                })
        }
    </div>
</Slide>

<script>
    import { gsap } from "gsap";
    const slide = document.querySelector(".emoji-slide");

    slide?.addEventListener("slide-enter", () => {
        const intro = slide.querySelector(".intro");
        const items = slide.querySelectorAll(".emoji-item");

        if (intro) {
            gsap.fromTo(
                intro,
                { autoAlpha: 0, scale: 0.8 },
                { autoAlpha: 1, scale: 1, duration: 1 },
            );
        }

        if (items.length) {
            gsap.fromTo(
                items,
                { y: 100, autoAlpha: 0 },
                {
                    y: 0,
                    autoAlpha: 1,
                    stagger: 0.2,
                    duration: 0.8,
                    ease: "back.out(2)",
                    delay: 0.3,
                },
            );
        }
    });
</script>

<style>
    .intro {
        position: absolute;
        top: 20%;
        width: 80%;
        text-align: center;
        opacity: 0;
        visibility: hidden;
    }

    .emoji-podium {
        display: flex;
        align-items: flex-end; /* Align bottom so they sit on a podium line implied */
        justify-content: center;
        gap: 4rem; /* More space */
        margin-top: 100px;
    }

    :global(.emoji-slide .emoji-item) {
        display: flex;
        flex-direction: column;
        align-items: center;
        opacity: 0;
        visibility: hidden;
        transition: transform 0.3s;
    }

    :global(.emoji-slide .rank-1) {
        transform: scale(1.6);
        order: 2;
        z-index: 10;
        margin-bottom: 2rem;
    }
    :global(.emoji-slide .rank-2) {
        transform: scale(1.2);
        order: 1;
        opacity: 0.8;
    }
    :global(.emoji-slide .rank-3) {
        transform: scale(1.2);
        order: 3;
        opacity: 0.8;
    }

    :global(.emoji-slide .emoji-char) {
        font-size: 5rem;
        filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.2));
    }

    :global(.emoji-slide .emoji-count) {
        font-size: 1.2rem;
        background: #25d366;
        padding: 5px 15px;
        border-radius: 20px;
        color: black;
        font-weight: bold;
        margin-top: 10px;
    }
</style>
