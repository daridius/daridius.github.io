---
import Slide from "./Slide.astro";
import { wrappedData } from "../data";
---

<Slide class="intro-slide">
    <div class="year-container">
        <h2 class="pre-title">El {wrappedData.year} de</h2>
        <h1 class="group-name" data-field="group_name">
            {wrappedData.group_name}
        </h1>
        <h2 class="post-title">WHATSAPP WRAPPED</h2>
        <h3 class="story-subtitle">Este a√±o hubo mucho que contar...</h3>
    </div>
    <div class="decorations">
        <span class="bubble b1" style="--d: 1s"></span>
        <span class="bubble b2" style="--d: 2s"></span>
        <span class="bubble b3" style="--d: 0.5s"></span>
    </div>
</Slide>

<script>
    import { gsap } from "gsap";
    const slide = document.querySelector(".intro-slide");

    slide?.addEventListener("slide-enter", () => {
        gsap.fromTo(
            ".year-container",
            { scale: 0.8, autoAlpha: 0 },
            {
                scale: 1,
                autoAlpha: 1,
                duration: 1,
                ease: "slow(0.7, 0.7, false)",
            },
        );

        gsap.fromTo(
            ".bubble",
            { scale: 0 },
            { scale: 1, stagger: 0.2, duration: 0.8, ease: "back.out" },
        );
    });

    // Listen for dynamic data injection
    document.addEventListener("wrapped-data-ready", (e: any) => {
        const data = e.detail;
        const groupEl = slide?.querySelector('[data-field="group_name"]');
        if (groupEl) groupEl.textContent = data.group_name;
    });
</script>

<style>
    .year-container {
        text-align: center;
        z-index: 2;
        opacity: 0;
        visibility: hidden;
    }

    .pre-title,
    .post-title {
        font-size: 1.5rem;
        font-weight: 300;
        letter-spacing: 0.2em;
        margin: 0;
        color: var(--whatsapp-green);
        text-transform: uppercase;
    }

    .group-name {
        font-size: 4rem; /* Smaller than 8rem to fit text */
        font-weight: 800;
        margin: 0.5rem 0;
        background: linear-gradient(
            135deg,
            #fff 0%,
            var(--whatsapp-green) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1.1;
        filter: drop-shadow(0 0 20px rgba(37, 211, 102, 0.3));
        padding: 0 1rem;
    }

    .story-subtitle {
        font-size: 1.2rem;
        margin-top: 2rem;
        font-style: italic;
        opacity: 0.8;
    }

    .decorations {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
    }

    .bubble {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(
            circle at 30% 30%,
            rgba(37, 211, 102, 0.2),
            rgba(37, 211, 102, 0)
        );
        animation: float 6s ease-in-out infinite;
        animation-delay: var(--d);
        opacity: 0;
    }

    .b1 {
        width: 300px;
        height: 300px;
        top: -50px;
        left: -100px;
    }
    .b2 {
        width: 200px;
        height: 200px;
        bottom: 10%;
        right: -50px;
    }
    .b3 {
        width: 150px;
        height: 150px;
        top: 40%;
        left: 80%;
    }

    @keyframes float {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-20px);
        }
    }
</style>
